---
- hosts: api
  become: true
  become_user: root
  pre_tasks:
    - shell: iptables -F
    - name: workaround - assign admin role to service members
      shell: source /root/openrc.admintoken;openstack role add --project service --group service admin
      ignore_errors: true
  roles:
    - { role: ansible-role-puppetize, ansible_fqdn: "{{inventory_hostname_short}}.openstacklocal", ignore_puppetize_errors: true }
  post_tasks:
    - name: workaround - use insecure in all /bin/openstack calls due to self-signed cert
      lineinfile:
        path: /bin/openstack
        insertafter: import\ sys
        line: "sys.argv.append('--insecure')"
      ignore_errors: true
